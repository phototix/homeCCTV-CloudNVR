<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .gallery-img {
            cursor: pointer;
            transition: transform 0.2s;
            height: 200px;
            width: 100%;
            object-fit: cover;
        }
        .gallery-img:hover {
            transform: scale(1.02);
        }
        .modal-img {
            max-width: 100%;
            max-height: 80vh;
        }
        .image-caption {
            margin-top: 8px;
            font-size: 0.9rem;
            text-align: center;
            word-break: break-all;
        }
        .gallery-item {
            margin-bottom: 20px;
        }
        .filter-btn.active {
            background-color: #0d6efd;
            color: white;
        }
        .btn-group {
            margin-bottom: 20px;
        }
        .modal-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 60px;
            font-size: 1.5rem;
            z-index: 10;
        }
        .modal-nav-btn:hover {
            background: rgba(0,0,0,0.7);
        }
        .modal-nav-btn.prev {
            left: 10px;
        }
        .modal-nav-btn.next {
            right: 10px;
        }
        .modal-content {
            position: relative;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading-spinner.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">Image Gallery</h1>
        
        <!-- Filter Buttons -->
        <div class="row justify-content-center">
            <div class="col-auto">
                <div class="btn-group" role="group" aria-label="Image filters">
                    <button type="button" class="btn btn-outline-primary filter-btn active" data-filter="all">All</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-filter="cam1">Camera 1</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-filter="cam2">Camera 2</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-filter="cam3">Camera 3</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-filter="grid">Grid</button>
                </div>
            </div>
        </div>
        
        <div class="row" id="gallery-container">
            <!-- Images will be loaded here -->
        </div>
        
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <!-- Modal for full image view -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="modal-nav-btn prev">&lt;</button>
                    <img src="" class="modal-img" id="fullImage">
                    <button class="modal-nav-btn next">&gt;</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let allImages = [];
            let filteredImages = [];
            let currentImageIndex = 0;
            let currentPage = 1;
            let currentFilter = 'all';
            let isLoading = false;
            let hasMore = true;
            
            const galleryContainer = document.getElementById('gallery-container');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            const fullImage = document.getElementById('fullImage');
            const modalTitle = document.getElementById('imageModalLabel');
            const prevBtn = document.querySelector('.modal-nav-btn.prev');
            const nextBtn = document.querySelector('.modal-nav-btn.next');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // Initial load
            loadImages(currentPage, currentFilter);
            
            // Set up filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Update active state
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Reset for new filter
                    currentPage = 1;
                    currentFilter = this.dataset.filter;
                    galleryContainer.innerHTML = '';
                    loadImages(currentPage, currentFilter);
                });
            });
            
            // Set up scroll listener for infinite scroll
            window.addEventListener('scroll', function() {
                if (isLoading || !hasMore) return;
                
                if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                    currentPage++;
                    loadImages(currentPage, currentFilter);
                }
            });
            
            // Function to load images
            function loadImages(page, filter = 'all') {
                isLoading = true;
                loadingSpinner.classList.add('show');
                
                fetch(`listImages.php?page=${page}&filter=${filter}`)
                    .then(response => response.json())
                    .then(data => {
                        const newImages = data.images;
                        hasMore = data.pagination.hasMore;
                        
                        if (page === 1) {
                            // First page of new filter
                            filteredImages = newImages;
                        } else {
                            // Append to existing filtered images
                            filteredImages = [...filteredImages, ...newImages];
                        }
                        
                        renderGallery(newImages, page === 1);
                        isLoading = false;
                        loadingSpinner.classList.remove('show');
                    })
                    .catch(error => {
                        console.error('Error loading images:', error);
                        isLoading = false;
                        loadingSpinner.classList.remove('show');
                    });
            }
            
            // Rest of your JavaScript remains the same...
            // [Keep all the remaining functions unchanged]
        });
    </script>
</body>
</html>